#!/usr/bin/env python3
"""
10案の設計ケースを一括登録するスクリプト
マークダウンファイルの定義に基づいてネットワークJSONを生成
"""

import sqlite3
import json
import uuid
from datetime import datetime

PROJECT_ID = "5a8b0f7b-5994-4eba-b0f6-2ee15340c07f"
DB_PATH = "data/local.db"

# Performance ID mapping
PERF_IDS = {
    "P1": "0cc6585b-2acb-4b8f-b14a-242bf03284b9",
    "P2": "3b99dfec-89ad-4030-8da6-1173ead9d4ac",
    "P3": "d387289f-3f72-457d-a5be-3638eba5415a",
    "P4": "e1a59954-f15c-47ec-aa90-2be395fcdcef",
    "P5": "ddbfbb68-21ff-4157-b19e-39b79dbdb3b2",
    "P6": "a734a37b-2752-4de5-b057-60e5cf993584",
    "P7": "3242b7be-b1c2-4607-b8c9-7717e7a67b46",
    "P8": "dc90b099-42c2-43b6-b7d1-a46642bb0f23",
    "P9": "9404bf91-8e1d-4625-875b-5eedea677b0d",
    "P10": "7c20d95b-b674-464a-8a53-b1608aed6c04",
}

PERF_LABELS = {
    "P1": "P1_エネルギー変換効率",
    "P2": "P2_CO2排出量",
    "P3": "P3_海域占有面積",
    "P4": "P4_発電コスト",
    "P5": "P5_航路遮断度",
    "P6": "P6_視認性",
    "P7": "P7_耐波性",
    "P8": "P8_雇用機会",
    "P9": "P9_鳥類視認性",
    "P10": "P10_海洋生物影響",
}

PERF_UNITS = {
    "P1": "[-]",
    "P2": "[tCO2/年]",
    "P3": "[km²]",
    "P4": "[円/kWh]",
    "P5": "[-]",
    "P6": "[分角]",
    "P7": "[-]",
    "P8": "[人]",
    "P9": "[m²]",
    "P10": "[m³]",
}

# 10案のシミュレーション結果 (P1~P10)
PERF_VALUES = {
    1: [0.772, 1.58, 85.3, 19.2, 0.87, 28.3, 1.56, 1159, 222, 102.4],
    2: [1.000, 2.61, 141.1, 31.7, 0.87, 28.3, 8.86, 1918, 222, 102.4],
    3: [0.273, 7.67, 414.2, 93.1, 0.87, 28.3, 1.23, 5628, 222, 102.4],
    4: [0.772, 1.58, 85.3, 26.8, 0.87, 28.3, 1.56, 1159, 222, 102.4],
    5: [1.000, 2.61, 141.1, 44.3, 0.87, 28.3, 8.86, 1918, 222, 102.4],
    6: [0.273, 7.67, 414.2, 130.0, 0.87, 28.3, 1.23, 5628, 222, 102.4],
    7: [0.358, 7.82, 422.3, 154.1, 0.87, 28.3, 3.82, 5739, 222, 166.5],
    8: [0.358, 7.82, 422.3, 215.2, 0.87, 28.3, 3.82, 5739, 222, 166.5],
    9: [0.728, 1.01, 54.7, 20.0, 0.87, 28.3, 1.23, 743, 222, 166.5],
    10: [0.728, 1.01, 54.7, 27.9, 0.87, 28.3, 1.23, 743, 222, 166.5],
}

# 10案の定義
CASE_DEFINITIONS = {
    1: {
        "name": "No.1 カイト×横移動×輸送船",
        "step": "Step 1",
        "attrs": {
            "A1": "発電出力", "A2": "浮体速度(横)", "A3": "流体抵抗", "A4": "浮体設備コスト",
            "A5": "輸送コスト", "A6": "稼働率", "A7": "ネット発電量", "A8": "浮体台数",
            "A9": "燃料消費量", "A10": "浮体視認サイズ"
        },
        "vars": {
            "V1": "カイト面積", "V2": "浮体サイズ", "V3": "センターボード面積",
            "V4": "輸送船団規模", "V5": "運用スケジュール"
        },
        "ents": {
            "E1": "浮体", "E2": "カイトシステム", "E3": "センターボード",
            "E4": "輸送船団", "E5": "運用環境"
        },
        "ve_edges": [("E1", "V2"), ("E2", "V1"), ("E3", "V3"), ("E4", "V4"), ("E5", "V5")],
        "av_edges": [
            ("V1", "A1", 5), ("V1", "A2", 3), ("V1", "A4", 3), ("V1", "A10", 5),
            ("V2", "A3", 3), ("V2", "A4", 5), ("V2", "A10", 5),
            ("V3", "A3", 3), ("V3", "A2", -1),
            ("V4", "A5", 5), ("V4", "A9", 5),
            ("V5", "A6", 5)
        ],
        "aa_edges": [
            ("A2", "A3", 5), ("A3", "A2", -5), ("A2", "A1", 3),
            ("A3", "A7", -1), ("A1", "A7", 5), ("A6", "A7", 5),
            ("A7", "A8", -5), ("A8", "A5", 3), ("A8", "A9", 3)
        ],
        "pa_edges": [
            ("A7", "P1", 5), ("A7", "P4", -5), ("A4", "P4", 5), ("A5", "P4", 3),
            ("A9", "P2", 5), ("A8", "P2", 5),
            ("A8", "P3", 5), ("A8", "P5", 5), ("A8", "P8", 5),
            ("A10", "P6", 5), ("A10", "P10", 5), ("V1", "P9", 5),
            ("A2", "P7", -3), ("V2", "P7", 3)
        ]
    },
    2: {
        "name": "No.2 カイト×停留×輸送船",
        "step": "Step 2-1",
        "attrs": {
            "A1": "発電出力", "A2": "位置保持消費電力", "A3": "位置保持必要推力",
            "A4": "浮体設備コスト", "A5": "輸送コスト", "A6": "稼働率",
            "A7": "ネット発電量", "A8": "浮体台数", "A9": "燃料消費量", "A10": "浮体視認サイズ"
        },
        "vars": {
            "V1": "カイト面積", "V2": "浮体サイズ", "V3": "スクリュー直径",
            "V4": "輸送船団規模", "V5": "運用スケジュール"
        },
        "ents": {
            "E1": "浮体", "E2": "カイトシステム", "E3": "電気推進機",
            "E4": "輸送船団", "E5": "運用環境"
        },
        "ve_edges": [("E1", "V2"), ("E2", "V1"), ("E3", "V3"), ("E4", "V4"), ("E5", "V5")],
        "av_edges": [
            ("V1", "A1", 5), ("V1", "A3", 5), ("V1", "A4", 3), ("V1", "A10", 5),
            ("V2", "A4", 5), ("V2", "A10", 5),
            ("V3", "A2", -3), ("V3", "A4", 3),
            ("V4", "A5", 5), ("V4", "A9", 5),
            ("V5", "A6", 5)
        ],
        "aa_edges": [
            ("A3", "A2", 5), ("A2", "A7", -5), ("A1", "A7", 5), ("A6", "A7", 5),
            ("A7", "A8", -5), ("A8", "A5", 3), ("A8", "A9", 3)
        ],
        "pa_edges": [
            ("A7", "P1", 5), ("A7", "P4", -5), ("A4", "P4", 5), ("A5", "P4", 3),
            ("A9", "P2", 5), ("A8", "P3", 5), ("A8", "P5", 5), ("A8", "P8", 5),
            ("A10", "P6", 5), ("A10", "P10", 5), ("V1", "P9", 5),
            ("V2", "P7", 5), ("A10", "P7", 3), ("V2", "P10", 5)
        ]
    },
    3: {
        "name": "No.3 カイト×流され×輸送船",
        "step": "Step 2-2",
        "attrs": {
            "A1": "流され発電出力", "A2": "流され速度", "A3": "戻り速度",
            "A4": "戻り消費電力", "A5": "浮体設備コスト", "A6": "輸送コスト",
            "A7": "稼働率", "A8": "ネット発電量", "A9": "浮体台数",
            "A10": "燃料消費量", "A11": "浮体視認サイズ"
        },
        "vars": {
            "V1": "カイト面積", "V2": "浮体サイズ", "V3": "水中抵抗体面積",
            "V4": "戻りプロペラ出力", "V5": "輸送船団規模", "V6": "運用スケジュール"
        },
        "ents": {
            "E1": "浮体", "E2": "カイトシステム", "E3": "水中抵抗体",
            "E4": "戻り推進機", "E5": "輸送船団", "E6": "運用環境"
        },
        "ve_edges": [("E1", "V2"), ("E2", "V1"), ("E3", "V3"), ("E4", "V4"), ("E5", "V5"), ("E6", "V6")],
        "av_edges": [
            ("V1", "A1", 5), ("V1", "A2", 3), ("V1", "A5", 3), ("V1", "A11", 5),
            ("V2", "A5", 5), ("V2", "A11", 5),
            ("V3", "A2", -5), ("V3", "A5", 3),
            ("V4", "A3", 5), ("V4", "A4", 5),
            ("V5", "A6", 5), ("V5", "A10", 5),
            ("V6", "A7", 5)
        ],
        "aa_edges": [
            ("A2", "A1", -3), ("A1", "A8", 5), ("A4", "A8", -3),
            ("A3", "A7", 1), ("A7", "A8", 5),
            ("A8", "A9", -5), ("A9", "A6", 3), ("A9", "A10", 3)
        ],
        "pa_edges": [
            ("A8", "P1", 5), ("A8", "P4", -5), ("A5", "P4", 5), ("A6", "P4", 3),
            ("A10", "P2", 5), ("A9", "P3", 5), ("A9", "P5", 5), ("A9", "P8", 5),
            ("A11", "P6", 5), ("A11", "P10", 3), ("V1", "P9", 5),
            ("A2", "P7", 5), ("V3", "P10", 5), ("V2", "P10", 3)
        ]
    },
    4: {
        "name": "No.4 カイト×横移動×浮体",
        "step": "Step 3-1",
        "attrs": {
            "A1": "発電出力", "A2": "浮体速度(横)", "A3": "流体抵抗",
            "A4": "浮体設備コスト", "A5": "移動コスト", "A6": "稼働率",
            "A7": "ネット発電量", "A8": "浮体台数", "A9": "燃料消費量",
            "A10": "浮体視認サイズ", "A11": "往復移動時間"
        },
        "vars": {
            "V1": "カイト面積", "V2": "浮体サイズ", "V3": "センターボード面積",
            "V4": "運用スケジュール"
        },
        "ents": {
            "E1": "浮体", "E2": "カイトシステム", "E3": "センターボード",
            "E4": "運用環境"
        },
        "ve_edges": [("E1", "V2"), ("E2", "V1"), ("E3", "V3"), ("E4", "V4")],
        "av_edges": [
            ("V1", "A1", 5), ("V1", "A2", 3), ("V1", "A4", 3), ("V1", "A10", 5),
            ("V2", "A4", 5), ("V2", "A10", 5), ("V2", "A11", -5),
            ("V3", "A3", 3), ("V3", "A2", -1),
            ("V4", "A11", 5), ("V4", "A5", 3), ("V4", "A9", 3)
        ],
        "aa_edges": [
            ("A2", "A1", 3), ("A2", "A3", 5), ("A3", "A2", -5),
            ("A11", "A6", -5), ("A6", "A7", 5),
            ("A3", "A7", -1), ("A1", "A7", 5),
            ("A7", "A8", -5), ("A8", "A5", 3), ("A8", "A9", 3)
        ],
        "pa_edges": [
            ("A7", "P1", 5), ("A7", "P4", -5), ("A4", "P4", 5), ("A5", "P4", 3),
            ("A9", "P2", 5), ("A8", "P3", 5), ("A8", "P5", 5), ("A8", "P8", 5),
            ("A10", "P6", 5), ("A10", "P10", 5), ("V1", "P9", 5),
            ("A2", "P7", -3), ("V2", "P7", 3)
        ]
    },
    5: {
        "name": "No.5 カイト×停留×浮体",
        "step": "Step 3-2",
        "attrs": {
            "A1": "発電出力", "A2": "位置保持消費電力", "A3": "位置保持必要推力",
            "A4": "浮体設備コスト", "A5": "移動コスト", "A6": "稼働率",
            "A7": "ネット発電量", "A8": "浮体台数", "A9": "燃料消費量",
            "A10": "浮体視認サイズ", "A11": "往復移動時間", "A12": "移動消費電力"
        },
        "vars": {
            "V1": "カイト面積", "V2": "浮体サイズ", "V3": "スクリュー直径",
            "V4": "運用スケジュール"
        },
        "ents": {
            "E1": "浮体", "E2": "カイトシステム", "E3": "電気推進機",
            "E4": "運用環境"
        },
        "ve_edges": [("E1", "V2"), ("E2", "V1"), ("E3", "V3"), ("E4", "V4")],
        "av_edges": [
            ("V1", "A1", 5), ("V1", "A3", 5), ("V1", "A4", 3), ("V1", "A10", 5),
            ("V2", "A4", 5), ("V2", "A10", 5), ("V2", "A11", -5),
            ("V3", "A2", -3), ("V3", "A4", 3), ("V3", "A12", -3),
            ("V4", "A11", 5), ("V4", "A5", 3), ("V4", "A9", 3)
        ],
        "aa_edges": [
            ("A3", "A2", 5), ("A2", "A7", -5),
            ("A11", "A6", -5), ("A6", "A7", 5), ("A12", "A7", -3),
            ("A1", "A7", 5),
            ("A7", "A8", -5), ("A8", "A5", 3), ("A8", "A9", 3)
        ],
        "pa_edges": [
            ("A7", "P1", 5), ("A7", "P4", -5), ("A4", "P4", 5), ("A5", "P4", 3),
            ("A9", "P2", 5), ("A8", "P3", 5), ("A8", "P5", 5), ("A8", "P8", 5),
            ("A10", "P6", 5), ("A10", "P10", 5), ("V1", "P9", 5),
            ("V2", "P7", 5), ("A10", "P7", 3)
        ]
    },
    6: {
        "name": "No.6 カイト×流され×浮体",
        "step": "Step 3-3",
        "attrs": {
            "A1": "流され発電出力", "A2": "流され速度", "A3": "戻り速度",
            "A4": "戻り/移動消費電力", "A5": "浮体設備コスト", "A6": "移動コスト",
            "A7": "稼働率", "A8": "ネット発電量", "A9": "浮体台数",
            "A10": "燃料消費量", "A11": "浮体視認サイズ", "A12": "総移動距離"
        },
        "vars": {
            "V1": "カイト面積", "V2": "浮体サイズ", "V3": "水中抵抗体面積",
            "V4": "戻りプロペラ出力", "V5": "運用スケジュール"
        },
        "ents": {
            "E1": "浮体", "E2": "カイトシステム", "E3": "水中抵抗体",
            "E4": "戻り推進機", "E5": "運用環境"
        },
        "ve_edges": [("E1", "V2"), ("E2", "V1"), ("E3", "V3"), ("E4", "V4"), ("E5", "V5")],
        "av_edges": [
            ("V1", "A1", 5), ("V1", "A2", 3), ("V1", "A5", 3), ("V1", "A11", 5),
            ("V2", "A5", 5), ("V2", "A11", 5), ("V2", "A12", -5),
            ("V3", "A2", -5), ("V3", "A5", 3),
            ("V4", "A3", 5), ("V4", "A4", 5),
            ("V5", "A12", 5), ("V5", "A7", 5), ("V5", "A6", 5), ("V5", "A10", 5)
        ],
        "aa_edges": [
            ("A2", "A1", -3),
            ("A12", "A7", -5), ("A12", "A4", 5),
            ("A4", "A8", -3), ("A3", "A7", 3),
            ("A1", "A8", 5), ("A7", "A8", 5),
            ("A8", "A9", -5), ("A9", "A6", 3), ("A9", "A10", 3)
        ],
        "pa_edges": [
            ("A8", "P1", 5), ("A8", "P4", -5), ("A5", "P4", 5), ("A6", "P4", 3),
            ("A10", "P2", 5), ("A9", "P3", 5), ("A9", "P5", 5), ("A9", "P8", 5),
            ("A11", "P6", 5), ("A11", "P10", 3), ("V1", "P9", 5),
            ("A2", "P7", 5), ("V3", "P10", 5), ("V2", "P10", 3)
        ]
    },
    7: {
        "name": "No.7 タービン×横移動×輸送船",
        "step": "Step 4-1",
        "attrs": {
            "A1": "タービン発電出力", "A2": "浮体速度", "A3": "タービン抵抗",
            "A4": "船体流体抵抗", "A5": "浮体設備コスト", "A6": "輸送コスト",
            "A7": "稼働率", "A8": "ネット発電量", "A9": "浮体台数",
            "A10": "燃料消費量", "A11": "浮体視認サイズ"
        },
        "vars": {
            "V1": "タービン直径", "V2": "カイト面積", "V3": "浮体サイズ",
            "V4": "センターボード面積", "V5": "輸送船団規模", "V6": "運用スケジュール"
        },
        "ents": {
            "E1": "浮体", "E2": "水中タービン", "E3": "カイト",
            "E4": "センターボード", "E5": "輸送船団", "E6": "運用環境"
        },
        "ve_edges": [("E1", "V3"), ("E2", "V1"), ("E3", "V2"), ("E4", "V4"), ("E5", "V5"), ("E6", "V6")],
        "av_edges": [
            ("V1", "A1", 5), ("V1", "A3", 5), ("V1", "A5", 3), ("V1", "A11", 5),
            ("V2", "A2", 5), ("V2", "A5", 3), ("V2", "A11", 3),
            ("V3", "A4", 3), ("V3", "A5", 5), ("V3", "A11", 3),
            ("V5", "A6", 5), ("V5", "A10", 5),
            ("V6", "A7", 5), ("V4", "A4", -1)
        ],
        "aa_edges": [
            ("A2", "A1", 5), ("A2", "A3", 5), ("A3", "A2", -5),
            ("A2", "A4", 3), ("A4", "A2", -3),
            ("A1", "A8", 5), ("A7", "A8", 5),
            ("A8", "A9", -5), ("A9", "A6", 3), ("A9", "A10", 3), ("A9", "A5", 1)
        ],
        "pa_edges": [
            ("A8", "P1", 5), ("A8", "P4", -5), ("A5", "P4", 5), ("A6", "P4", 3),
            ("A10", "P2", 5), ("A9", "P3", 5), ("A9", "P5", 5), ("A9", "P8", 5),
            ("A11", "P6", 5), ("A11", "P10", 3), ("V2", "P9", 5),
            ("A2", "P7", -3), ("V3", "P7", 3), ("V1", "P10", 3)
        ]
    },
    8: {
        "name": "No.8 タービン×横移動×浮体",
        "step": "Step 4-2",
        "attrs": {
            "A1": "タービン発電出力", "A2": "浮体速度", "A3": "タービン抵抗",
            "A4": "移動抵抗", "A5": "浮体設備コスト", "A6": "移動コスト",
            "A7": "稼働率", "A8": "ネット発電量", "A9": "浮体台数",
            "A10": "燃料消費量", "A11": "浮体視認サイズ", "A12": "往復移動時間"
        },
        "vars": {
            "V1": "タービン直径", "V2": "カイト面積", "V3": "浮体サイズ",
            "V4": "センターボード面積", "V5": "運用スケジュール"
        },
        "ents": {
            "E1": "浮体", "E2": "水中タービン", "E3": "カイト",
            "E4": "センターボード", "E5": "運用環境"
        },
        "ve_edges": [("E1", "V3"), ("E2", "V1"), ("E3", "V2"), ("E4", "V4"), ("E5", "V5")],
        "av_edges": [
            ("V1", "A1", 5), ("V1", "A3", 5), ("V1", "A4", 5), ("V1", "A5", 3), ("V1", "A11", 5),
            ("V2", "A2", 5), ("V2", "A5", 3), ("V2", "A11", 3),
            ("V3", "A5", 5), ("V3", "A11", 3), ("V3", "A12", -5),
            ("V5", "A12", 5), ("V5", "A6", 3), ("V5", "A10", 3)
        ],
        "aa_edges": [
            ("A2", "A1", 5), ("A2", "A3", 5), ("A3", "A2", -5),
            ("A4", "A12", 3), ("A12", "A7", -5),
            ("A1", "A8", 5), ("A7", "A8", 5),
            ("A8", "A9", -5), ("A9", "A6", 3), ("A9", "A10", 3), ("A9", "A5", 1), ("A4", "A10", 3)
        ],
        "pa_edges": [
            ("A8", "P1", 5), ("A8", "P4", -5), ("A5", "P4", 5), ("A6", "P4", 3),
            ("A10", "P2", 5), ("A9", "P3", 5), ("A9", "P5", 5), ("A9", "P8", 5),
            ("A11", "P6", 5), ("A11", "P10", 3), ("V2", "P9", 5),
            ("A2", "P7", -3), ("V3", "P7", 3), ("V1", "P10", 3)
        ]
    },
    9: {
        "name": "No.9 タービン×流され×輸送船",
        "step": "Step 4-3",
        "attrs": {
            "A1": "タービン発電出力", "A2": "流され速度", "A3": "タービン抵抗",
            "A4": "戻り速度", "A5": "戻り消費電力", "A6": "浮体設備コスト",
            "A7": "輸送コスト", "A8": "稼働率", "A9": "ネット発電量",
            "A10": "浮体台数", "A11": "燃料消費量", "A12": "浮体視認サイズ"
        },
        "vars": {
            "V1": "タービン直径", "V2": "カイト面積", "V3": "浮体サイズ",
            "V4": "水中抵抗体面積", "V5": "戻りプロペラ出力",
            "V6": "輸送船団規模", "V7": "運用スケジュール"
        },
        "ents": {
            "E1": "浮体", "E2": "水中タービン", "E3": "カイト",
            "E4": "水中抵抗体", "E5": "戻り推進機", "E6": "輸送船団", "E7": "運用環境"
        },
        "ve_edges": [("E1", "V3"), ("E2", "V1"), ("E3", "V2"), ("E4", "V4"), ("E5", "V5"), ("E6", "V6"), ("E7", "V7")],
        "av_edges": [
            ("V1", "A1", 5), ("V1", "A3", 5), ("V1", "A6", 3),
            ("V2", "A2", -3), ("V2", "A6", 3),
            ("V4", "A2", -5), ("V4", "A6", 3),
            ("V5", "A4", 5), ("V5", "A5", 5),
            ("V3", "A6", 5), ("V3", "A12", 3),
            ("V6", "A7", 5), ("V6", "A11", 5),
            ("V7", "A8", 5), ("V2", "A12", 3), ("V1", "A12", 5)
        ],
        "aa_edges": [
            ("A2", "A1", 5), ("A3", "A2", 3),
            ("A1", "A9", 5), ("A5", "A9", -3), ("A8", "A9", 5),
            ("A4", "A8", 3),
            ("A9", "A10", -5), ("A10", "A7", 3), ("A10", "A11", 3),
            ("A10", "A6", 1), ("A2", "A3", 3), ("A3", "A9", -1)
        ],
        "pa_edges": [
            ("A9", "P1", 5), ("A9", "P4", -5), ("A6", "P4", 5), ("A7", "P4", 3),
            ("A11", "P2", 5), ("A10", "P3", 5), ("A10", "P5", 5), ("A10", "P8", 5),
            ("A12", "P6", 5), ("A12", "P10", 3), ("V2", "P9", 5),
            ("A2", "P7", 5), ("V4", "P10", 5), ("V1", "P10", 3)
        ]
    },
    10: {
        "name": "No.10 タービン×流され×浮体",
        "step": "Step 4-4",
        "attrs": {
            "A1": "タービン発電出力", "A2": "流され速度", "A3": "タービン抵抗",
            "A4": "戻り速度", "A5": "戻り/移動消費電力", "A6": "浮体設備コスト",
            "A7": "移動コスト", "A8": "稼働率", "A9": "ネット発電量",
            "A10": "浮体台数", "A11": "燃料消費量", "A12": "浮体視認サイズ", "A13": "総移動距離"
        },
        "vars": {
            "V1": "タービン直径", "V2": "カイト面積", "V3": "浮体サイズ",
            "V4": "水中抵抗体面積", "V5": "戻りプロペラ出力", "V6": "運用スケジュール"
        },
        "ents": {
            "E1": "浮体", "E2": "水中タービン", "E3": "カイト",
            "E4": "水中抵抗体", "E5": "戻り推進機", "E6": "運用環境"
        },
        "ve_edges": [("E1", "V3"), ("E2", "V1"), ("E3", "V2"), ("E4", "V4"), ("E5", "V5"), ("E6", "V6")],
        "av_edges": [
            ("V1", "A1", 5), ("V1", "A3", 5), ("V1", "A6", 3),
            ("V2", "A2", -3), ("V2", "A6", 3),
            ("V4", "A2", -5), ("V4", "A6", 3),
            ("V5", "A4", 5), ("V5", "A5", 5),
            ("V3", "A6", 5), ("V3", "A12", 3), ("V3", "A13", -3),
            ("V6", "A13", 5), ("V6", "A7", 3), ("V6", "A11", 3),
            ("V2", "A12", 3), ("V1", "A12", 5)
        ],
        "aa_edges": [
            ("A2", "A1", 5), ("A3", "A2", 3),
            ("A1", "A9", 5), ("A5", "A9", -3), ("A8", "A9", 5),
            ("A4", "A8", 3), ("A13", "A8", -5),
            ("A9", "A10", -5), ("A10", "A7", 3), ("A10", "A11", 3),
            ("A10", "A6", 1), ("A2", "A3", 3), ("A3", "A9", -1)
        ],
        "pa_edges": [
            ("A9", "P1", 5), ("A9", "P4", -5), ("A6", "P4", 5), ("A7", "P4", 3),
            ("A11", "P2", 5), ("A10", "P3", 5), ("A10", "P5", 5), ("A10", "P8", 5),
            ("A12", "P6", 5), ("A12", "P10", 3), ("V2", "P9", 5),
            ("A2", "P7", 5), ("V4", "P10", 5), ("V1", "P10", 3)
        ]
    },
}


def get_x_y(layer, idx, total):
    """レイアウト用座標"""
    y_positions = {1: 100, 2: 250, 3: 400, 4: 550}
    y = y_positions[layer]
    width = 1000
    margin = 50
    spacing = (width - 2 * margin) / max(total - 1, 1)
    x = margin + idx * spacing
    return x, y


def build_network(case_def):
    """ネットワークJSONを構築"""
    nodes = []
    node_ids = {}

    # Performance nodes (Layer 1)
    for i, (key, label) in enumerate(PERF_LABELS.items()):
        node_id = f"perf-{uuid.uuid4()}"
        x, y = get_x_y(1, i, 10)
        nodes.append({
            "id": node_id, "layer": 1, "type": "performance", "label": label,
            "x": x, "y": y, "performance_id": PERF_IDS[key], "x3d": None, "y3d": None
        })
        node_ids[key] = node_id

    # Attribute nodes (Layer 2)
    attrs = case_def["attrs"]
    for i, (key, label) in enumerate(attrs.items()):
        node_id = f"attr-{uuid.uuid4()}"
        x, y = get_x_y(2, i, len(attrs))
        nodes.append({
            "id": node_id, "layer": 2, "type": "attribute", "label": label,
            "x": x, "y": y, "x3d": None, "y3d": None
        })
        node_ids[key] = node_id

    # Variable nodes (Layer 3)
    vars_ = case_def["vars"]
    for i, (key, label) in enumerate(vars_.items()):
        node_id = f"var-{uuid.uuid4()}"
        x, y = get_x_y(3, i, len(vars_))
        nodes.append({
            "id": node_id, "layer": 3, "type": "variable", "label": label,
            "x": x, "y": y, "x3d": None, "y3d": None
        })
        node_ids[key] = node_id

    # Entity nodes (Layer 4)
    ents = case_def["ents"]
    for i, (key, label) in enumerate(ents.items()):
        node_id = f"ent-{uuid.uuid4()}"
        x, y = get_x_y(4, i, len(ents))
        nodes.append({
            "id": node_id, "layer": 4, "type": "entity", "label": label,
            "x": x, "y": y, "x3d": None, "y3d": None
        })
        node_ids[key] = node_id

    # Edges
    edges = []

    # VE edges (Entity-Variable, weight 0)
    for e, v in case_def["ve_edges"]:
        edges.append({"source": node_ids[e], "target": node_ids[v], "weight": 0})

    # AV edges (Variable → Attribute)
    for v, a, w in case_def["av_edges"]:
        edges.append({"source": node_ids[v], "target": node_ids[a], "weight": w})

    # AA edges (Attribute → Attribute)
    for a1, a2, w in case_def["aa_edges"]:
        edges.append({"source": node_ids[a1], "target": node_ids[a2], "weight": w})

    # PA edges (Attribute/Variable → Performance)
    for src, dst, w in case_def["pa_edges"]:
        edges.append({"source": node_ids[src], "target": node_ids[dst], "weight": w})

    return {"nodes": nodes, "edges": edges}


def build_performance_values(case_no):
    """性能値JSONを構築"""
    values = PERF_VALUES[case_no]
    result = []
    for i, key in enumerate(["P1", "P2", "P3", "P4", "P5", "P6", "P7", "P8", "P9", "P10"]):
        result.append({
            "performance_id": PERF_IDS[key],
            "value": values[i]
        })
    return result


def build_performance_snapshot(case_no):
    """性能スナップショットJSONを構築"""
    values = PERF_VALUES[case_no]
    result = []
    for i, key in enumerate(["P1", "P2", "P3", "P4", "P5", "P6", "P7", "P8", "P9", "P10"]):
        result.append({
            "performance_id": PERF_IDS[key],
            "name": PERF_LABELS[key],
            "unit": PERF_UNITS[key],
            "is_leaf": True,
            "value": values[i]
        })
    return result


def main():
    conn = sqlite3.connect(DB_PATH)
    cursor = conn.cursor()

    now = datetime.now().isoformat()

    print("=" * 60)
    print("10案を登録します")
    print("=" * 60)

    for case_no, case_def in CASE_DEFINITIONS.items():
        case_id = str(uuid.uuid4())
        name = case_def["name"]

        network = build_network(case_def)
        perf_values = build_performance_values(case_no)
        perf_snapshot = build_performance_snapshot(case_no)

        cursor.execute("""
            INSERT INTO design_cases (
                id, project_id, name, description,
                performance_values_json, network_json, performance_snapshot_json,
                created_at, updated_at
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
        """, (
            case_id,
            PROJECT_ID,
            name,
            f"{case_def['step']}: {name}",
            json.dumps(perf_values, ensure_ascii=False),
            json.dumps(network, ensure_ascii=False),
            json.dumps(perf_snapshot, ensure_ascii=False),
            now,
            now
        ))

        print(f"[{case_no}] {name}")
        print(f"     Nodes: {len(network['nodes'])}, Edges: {len(network['edges'])}")

    conn.commit()
    conn.close()

    print("\n" + "=" * 60)
    print("10案の登録が完了しました")
    print("=" * 60)


if __name__ == "__main__":
    main()
